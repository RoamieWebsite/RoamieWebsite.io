<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags for character set and viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">

    <!-- Title of the webpage -->
    <title>Roamie - Upload </title>
    <!-- Link to external CSS file -->
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="upload.css">

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <!-- Fonts for heading and body -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Eagle+Lake&display=swap" rel="stylesheet">

    <!-- Font Awesome Kit -->
    <script src="https://kit.fontawesome.com/c820918012.js" crossorigin="anonymous"></script>

    <!-- Chat Bot -->
    <script src="https://code.tidio.co/upoaadkyewzgxzqstjjcqrmwvdjzvqye.js" async></script>

</head>

<body>
    <!-- Header -->

    <nav>
        <!-- Logo image -->
        <div class="logo">
            <a href="#"><img src="logo.gif" alt="Logo" length="300" width="200"></a>
        </div>
        <!-- Navigation links -->
        <ul class="navbar">
            <li><a href="index.html">Home</a></li>
            <li class="submenu-parent">
                <a href="discover.html">Discover</a><i class="fas fa-caret-down"></i>
                <!-- Submenu for Discover -->
                <ul class="submenu">
                    <li><a href="upload.html">Upload</a></li>
                    <li><a href="bookingform.html">Bookingform</a></li>
                    <li><a href="packages.html">Packages</a></li>
                </ul>
            </li>
            <li class="submenu-parent">
                <a href="#">Info</a><i class="fas fa-caret-down"></i>
                <!-- Submenu for Info -->
                <ul class="submenu">
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="quiz.html">Quiz</a></li>
                    <li><a href="weather.html">Weather</a></li>
                    <li><a href="currency.html">Currency</a></li>
                </ul>
            </li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="aboutus.html">About Us</a></li>
            <li class="submenu-parent">
                <a href="contact.html">Contact Us</a><i class="fas fa-caret-down"></i>
                <ul class="submenu">
                    <li><a href="faq.html">FAQ</a></li>
                </ul>
            </li>
            <li><a href="register.html">
                    <i class="fa fa-user" aria-hidden="true"></i>
                </a></li>
            <li><a href="cart.html">
                    <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                </a></li>
        </ul>
    </nav>

    <!-- End of Header -->
    <!-- Main -->
    <div class="image-upload-container">
        <div class="card">
            <h3 class="upload-header">Upload Files</h3>
            <div class="drop-box">
                <header class="drop-header">
                    <h4 class="select-file">Select File here</h4>
                </header>
                <p class="file-support">Supported Formats: JPG, PNG</p>
                <input type="file" class="file-input" multiple />
                <button class="selectbutton">Select Images</button>
                <button class="uploadbutton">Upload</button>

                <br> <br>
                <div class="loading" style="display: none;">Loading...</div>
                <div class="progress-bar"></div>
                <div class="complete-msg"></div>
                <div class="images"></div>
            </div>
        </div>
    </div>
    <!-- End of main -->

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 col-md-6">
                    <!-- About section in the footer -->
                    <h6>About</h6>
                    <p class="text-justify">Welcome to Roamie, your passport to boundless adventures and unforgettable
                        journeys!
                        At Roamie, we believe that travel is not just about reaching a destination; it's about embracing
                        the
                        unknown,
                        discovering new cultures, and creating stories that last a lifetime.
                        Whether you're a seasoned globetrotter or a first-time explorer, Roamie is here to inspire,
                        guide, and
                        elevate
                        your travel experience.</p>
                </div>
                <div class="col-xs-6 col-md-3">
                    <!-- Quick Links section in the footer -->
                    <h6>Quick Links</h6>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Me</a></li>
                        <li><a href="explore.html">Explore</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="contact.html">Contact Me</a></li>
                    </ul>
                </div>
            </div>
            <hr>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-8 col-sm-6 col-xs-12">
                    <!-- Copyright information in the footer -->
                    <p class="copyright-text">Copyright &copy; 2023 All Rights Reserved by
                        <a href="#">Roamie</a>.
                    </p>
                </div>
                <div class="col-md-4 col-sm-6 col-xs-12">
                    <!-- Social media icons in the footer -->
                    <ul class="social-icons">
                        <li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
                        <li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
                        <li><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- End Footer -->

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getStorage, ref, listAll, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-storage.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";


        // My web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBwHXyVf3Ed4fw_SggzrpifbRzcOBd2_Ec",
            authDomain: "roamie-29b26.firebaseapp.com",
            databaseURL: "https://roamie-29b26-default-rtdb.firebaseio.com",
            projectId: "roamie-29b26",
            storageBucket: "roamie-29b26.appspot.com",
            messagingSenderId: "770720238385",
            appId: "1:770720238385:web:e0dccbec84ad562b35fe10",
            measurementId: "G-VQBEZ429JG"
        };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        const storage = getStorage();

        // Initialize Realtime Database and get a reference to the service
        const database = getDatabase();

        async function displayUserPictures(userId) {
            // Reference to storage bucket location for the specific user
            const storageRef = ref(storage, 'images/' + userId);

            try {
                // Get metadata about files in the bucket
                const list = await listAll(storageRef);
                let html = "";
                for (const itemRef of list.items) {
                    const url = await getDownloadURL(itemRef); // Wait for the download URL
                    html += `<img src="${url}" class="img-fluid">`;
                }
                document.querySelector('.images').innerHTML = html;
            } catch (error) {
                console.error("Error displaying user pictures:", error);
            }
        }



        const auth = getAuth();
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, allow upload functionality
                uploadButton.style.display = 'block';
                // Display pictures for logged-in user
                displayUserPictures(user.uid);
            } else {
                // No user is signed in, hide upload functionality and display alert
                uploadButton.style.display = 'none';
                alert("Only logged-in users can upload images.");
            }
        });


        // DOM references
        const loading = document.querySelector(".loading");
        const progressbar = document.querySelector(".progress-bar");
        const completeMsg = document.querySelector(".complete-msg");
        const imagesContainer = document.querySelector('.images');
        const uploadButton = document.querySelector('.uploadbutton');

        //Function to display uploaded images
        let files;

        // Function to handle file selection
        const selectbutton = () => {
            const inp = document.querySelector('.file-input');
            inp.click();
        };
        const buttonElement = document.querySelector('.selectbutton');
        buttonElement.onclick = selectbutton;

        // Function to get selected file data
        const getImageData = (e) => {
            files = e.target.files;
        };
        const fileInput = document.querySelector('.file-input');
        fileInput.addEventListener('change', getImageData);

        // Function to upload each selected image
        const uploadProcess = (file, fileName) => {
            return new Promise((resolve, reject) => {
                const storageRef = ref(storage, "images/" + fileName);
                const uploadTask = uploadBytesResumable(storageRef, file);

                uploadTask.on(
                    "state_changed",
                    (snapshot) => {
                        loading.style.display = 'block';
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressbar.style.width = progress + "%";
                    },
                    (error) => {
                        reject(error);
                    },
                    () => {
                        getDownloadURL(uploadTask.snapshot.ref)
                            .then((downloadURL) => {
                                resolve(downloadURL);
                            })
                            .catch((error) => {
                                reject(error);
                            });
                    }
                );
            });
        };


        // Function to upload images
        const uploadImages = async () => {
            for (let i = 0; i < files.length; i++) {
                const fileName = Math.round(Math.random() * 9999) + files[i].name;
                try {
                    const url = await uploadProcess(files[i], fileName);
                    if (url) {
                        loading.style.display = 'none';
                        const image = document.createElement("img");
                        image.style.display = 'block';
                        image.setAttribute('src', url);
                        image.className = 'img';
                        imagesContainer.appendChild(image);
                    }
                } catch (error) {
                    console.error("Error uploading file:", error);
                }
            }
            completeMsg.innerHTML = `${files.length} files uploaded successfully`;
        };


        // Calling the uploadImages function when upload button is clicked
        uploadButton.onclick = uploadImages;

    </script>

</body>

</html>
